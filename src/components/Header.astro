---
import { Auth, SignIn } from "auth-astro/components";
import { getSession } from "auth-astro/server";

const session = await getSession(Astro.request);
---

<div class="safety-menu">
  <div class="min-w-[100%] bg-[rgba(221,221,221,0)] z-[1000] relative">
    <div
      class="container-1180px flex justify-between max-w-[1180px] min-[80px] ml-auto mr-auto"
      style="align-items: center;"
    >
      <a
        href="/"
        class="w-nav-brand float-left relative"
        style="text-decoration: none;"
        ><img
          class="opacity-100 block border-none pt-0 h-[80px]"
          src="w-nav-logo.png"
          alt="brand-logo"
        /></a
      >
      <nav role="navigation" class="mr-[11px] float-right relative block">
        <div class="div-block-4" style="text-decoration: none;">
          <a
            class="ml-[10px] mr-[10px] p-[10px] font-semibold transition-all align-top text-left inline-block relative"
            href="/">Lorem</a
          >
          <a
            class="ml-[10px] mr-[10px] p-[10px] font-semibold transition-all align-top text-left inline-block relative"
            href="/">Lorem1</a
          >
          <a
            class="ml-[10px] mr-[10px] p-[10px] font-semibold transition-all align-top text-left inline-block relative"
            href="/">Lorem2</a
          >
          <a
            class="ml-[10px] mr-[10px] p-[10px] font-semibold transition-all align-top text-left inline-block relative"
            href="/">Lorem3</a
          >
        </div>
      </nav>
      <div class="nav-button-wrap justify-end min-w-[116px] flex">
        {
          session ? (
            <>
              <p>{session.user?.name}</p>
            </>
          ) : (
            <>
              <SignIn provider="twitch">
                <a
                  class="button-white w-button bg-white font-bold transition-all"
                  style="color: #121212; border-radius: 40px; padding: 13px 16px; font-size: 14px; line-height: 24px;"
                  href="/"
                  id="signin-button"
                >
                  Acceder
                </a>
              </SignIn>
            </>
          )
        }
      </div>
    </div>
  </div>
</div>

<script>
  const { signIn } = await import("auth-astro/client");

  const $button = document.querySelector("#signin-button");
  $button?.addEventListener("click", async (event) => {
    event.preventDefault();
    await signIn("twitch");
  });
</script>
